<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Projects | Ihuoma Obasi</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" crossorigin="anonymous" />
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Exo:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

<a href="#main-content" class="skip-link">Skip to main content</a>

<header>
  <nav class="navbar">
    <div class="logo">Ihuoma's Portfolio</div>
    <ul class="nav-links">
      <li><a href="index.html"><i class="fa-solid fa-house-user"></i>Home</a></li>
      <li><a href="projects.html" class="active"><i class="fa-solid fa-folder-open"></i>Projects</a></li>
      <li><a href="CV.html"><i class="fa-solid fa-file-lines"></i>CV</a></li>
      <li><a href="contact.html"><i class="fa-solid fa-envelope"></i>Contact</a></li>
    </ul>
    <div class="hamburger">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </nav>
</header>

<main class="projects-page" id="main-content">
  <div class="filter-bar">
    <button class="active" data-filter="all">All</button>
    <button data-filter="engineering">Engineering</button>
    <button data-filter="graphic">Graphic</button>
    <button data-filter="interior">Interior</button>
    <div class="tag-filter">
      <input type="text" id="tagInput" placeholder="Filter by tags (arduino, design, etc.)">
    </div>
  </div>

  <div class="grid-container">
    <div class="skeleton" style="height: 200px; border-radius: 15px;"></div>
    <div class="skeleton" style="height: 200px; border-radius: 15px;"></div>
    <div class="skeleton" style="height: 200px; border-radius: 15px;"></div>
  </div>
</main>

<div id="projectModal" class="modal" aria-hidden="true">
  <div class="modal-content">
    <button class="close-modal" aria-label="Close modal">&times;</button>
    <div id="modalContent"></div>
  </div>
</div>

<footer>
  <section class="footer-socials">
    <a href="https://www.instagram.com/stacy_leo15" target="_blank" aria-label="Instagram">
      <i class="fa-brands fa-instagram"></i><span>Instagram</span>
    </a>
    <a href="https://wa.me/2347059255765" target="_blank" aria-label="WhatsApp">
      <i class="fa-brands fa-whatsapp"></i><span>WhatsApp</span>
    </a>
    <a href="https://www.linkedin.com/in/ihuoma-obasi" target="_blank" aria-label="LinkedIn">
      <i class="fa-brands fa-linkedin"></i><span>LinkedIn</span>
    </a>
    <a href="https://github.com/Ihuomaleo" target="_blank" aria-label="GitHub">
      <i class="fa-brands fa-github"></i><span>GitHub</span>
    </a>
    <a href="https://twitter.com/obasi_ihuo42473" target="_blank" aria-label="Twitter">
      <i class="fa-brands fa-x-twitter"></i> <span>Twitter</span>
    </a>
  </section>
  <p>&copy; 2025 Ihuoma Ngozika Obasi</p>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const grid = document.querySelector('.grid-container');

  // Helper: Resolve image paths to the images/ folder if user provided a filename only
  function resolveMediaPath(src) {
    if (!src) return '';
    // If it's already an absolute path or external URL, use it directly
    if (src.startsWith('/') || src.startsWith('http')) return src;
    // Otherwise assume it's inside your project's images/ folder (you chose A)
    return 'images/' + src;
  }

  // Function to build the HTML for a single project card
  function createProjectCard(project) {
    const category = project.category || 'general';
    const tags = Array.isArray(project.tags) ? project.tags : [];
    const tagsString = tags.join(' ').toLowerCase();
    const tagsHTML = tags.map(tag => `<span>${tag}</span>`).join('');

    let mediaHTML = '';
    if (project.video_mp4) {
      const poster = project.video_poster ? resolveMediaPath(project.video_poster) : '';
      const videoSrc = resolveMediaPath(project.video_mp4);
      mediaHTML = `
        <video controls preload="metadata" poster="${poster}" style="display:none">
          <source src="${videoSrc}" type="video/mp4">
          Your browser doesn't support videos
        </video>
      `;
    } else if (project.image) {
      const imageSrc = resolveMediaPath(project.image);
      mediaHTML = `<img src="${imageSrc}" alt="${project.title || 'Project image'}" loading="lazy" style="display:none">`;
    }

    return `
      <div class="card" data-category="${category}" data-tags="${tagsString}">
        <div class="media-container">
          <div class="skeleton"></div>
          ${mediaHTML}
        </div>
        <div class="card-content">
          <h3>${project.title || 'No Title'}</h3>
          <p>${project.description || 'No description.'}</p>
          <div class="card-tags">
            ${tagsHTML}
          </div>
        </div>
      </div>
    `;
  }

  // Function to load and display all projects
  async function loadProjects() {
    try {
      // NOTE: this JSON should be the file managed by the CMS: src/data/projects.json
      const response = await fetch('src/data/projects.json', {cache: "no-store"});
      if (!response.ok) {
        // If 404 or other, show friendly message
        throw new Error('Network response was not ok: ' + response.status);
      }
      const json = await response.json();
      const projects = Array.isArray(json.projects) ? json.projects : [];

      if (projects.length > 0) {
        // Create the HTML string and insert once (faster)
        grid.innerHTML = projects.map(createProjectCard).join('');
      } else {
        grid.innerHTML = "<p>No projects found. Try adding some in the CMS!</p>";
      }

      // Now that the DOM has the cards, initialize interactivity
      initializeProjectScripts();

    } catch (error) {
      console.error('Failed to load projects:', error);
      grid.innerHTML = "<p>Error loading projects. Please check the console for details.</p>";
    }
  }

  // This function contains all the logic that needs to run AFTER projects are on the page
  function initializeProjectScripts() {
    // Project elements (now present in DOM)
    const filterButtons = document.querySelectorAll('.filter-bar button');
    const projectCards = document.querySelectorAll('.card');
    const tagInput = document.getElementById('tagInput');

    // Filter button behavior
    if (filterButtons && projectCards) {
      filterButtons.forEach(button => {
        button.addEventListener('click', () => {
          filterButtons.forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');
          const filterValue = button.dataset.filter;

          projectCards.forEach(card => {
            if (filterValue === 'all' || card.dataset.category === filterValue) {
              card.style.display = 'block';
              setTimeout(() => card.style.opacity = '1', 50);
            } else {
              card.style.opacity = '0';
              setTimeout(() => card.style.display = 'none', 300);
            }
          });
        });
      });
    }

    // Tag input filtering
    if (tagInput) {
      tagInput.addEventListener('input', function() {
        const searchTerm = this.value.trim().toLowerCase();
        projectCards.forEach(card => {
          const tags = (card.dataset.tags || '').toLowerCase();
          if (searchTerm === '' || tags.includes(searchTerm)) {
            card.style.display = 'block';
            setTimeout(() => card.style.opacity = '1', 50);
          } else {
            card.style.opacity = '0';
            setTimeout(() => card.style.display = 'none', 300);
          }
        });
      });
    }

    // IntersectionObserver for reveal animations
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('show');
        }
      });
    }, { threshold: 0.1 });

    projectCards.forEach(card => {
      observer.observe(card);
    });

    // Media loading handling: images and videos
    const medias = document.querySelectorAll('.card img, .card video');
    medias.forEach(media => {
      // for images
      if (media.tagName.toLowerCase() === 'img') {
        media.addEventListener('load', function() {
          const card = this.closest('.card');
          card.classList.add('loaded');
          const sk = card.querySelector('.skeleton');
          if (sk) sk.style.display = 'none';
        });
        // if already cached/complete
        if (media.complete && media.naturalWidth !== 0) {
          media.dispatchEvent(new Event('load'));
          media.style.display = 'block';
        } else {
          // make it visible once it loads (the load handler will show card)
          media.addEventListener('load', () => media.style.display = 'block');
        }
      }

      // for videos
      if (media.tagName.toLowerCase() === 'video') {
        media.addEventListener('loadeddata', function() {
          const card = this.closest('.card');
          card.classList.add('loaded');
          const sk = card.querySelector('.skeleton');
          if (sk) sk.style.display = 'none';
          this.style.display = 'block';
        });
        // try to show poster immediately; source will load progressively
        if (media.readyState >= 2) {
          media.dispatchEvent(new Event('loadeddata'));
        } else {
          media.addEventListener('loadeddata', () => media.style.display = 'block');
        }
      }
    });

    // Project Modal Functionality
    const modal = document.getElementById('projectModal');
    const closeBtn = document.querySelector('.close-modal');

    document.querySelectorAll('.card').forEach(card => {
      card.addEventListener('click', function() {
        const title = this.querySelector('h3') ? this.querySelector('h3').textContent : '';
        const description = this.querySelector('p') ? this.querySelector('p').textContent : '';
        const mediaElement = this.querySelector('img, video');
        const tags = (this.dataset.tags || '').split(' ').filter(Boolean);
        const category = this.dataset.category || 'N/A';

        const mediaClone = mediaElement ? mediaElement.cloneNode(true) : null;
        if (mediaClone) {
          mediaClone.style.display = 'block';
          mediaClone.removeAttribute('style'); // ensure it shows in modal
        }

        let tagsHTML = '';
        tags.forEach(tag => {
          if (tag) tagsHTML += `<span class="tag">${tag}</span>`;
        });

        document.getElementById('modalContent').innerHTML = `
          <h2>${title}</h2>
          <div class="modal-media">
            ${mediaClone ? mediaClone.outerHTML : '<p>No media available</p>'}
          </div>
          <p>${description}</p>
          <div class="project-details">
            <p><strong>Category:</strong> ${category.charAt(0).toUpperCase() + category.slice(1)}</p>
            <p><strong>Tags:</strong> <div class="modal-tags">${tagsHTML}</div></p>
            <a href="#" class="btn no-transition">View Project Details</a>
          </div>
        `;

        modal.style.display = 'flex';
        modal.setAttribute('aria-hidden', 'false');
      });
    });

    if (closeBtn) {
      closeBtn.addEventListener('click', () => {
        const modal = document.getElementById('projectModal');
        modal.style.display = 'none';
        modal.setAttribute('aria-hidden', 'true');
      });
    }
    window.addEventListener('click', e => {
      const modalEl = document.getElementById('projectModal');
      if (e.target === modalEl) {
        modalEl.style.display = 'none';
        modalEl.setAttribute('aria-hidden', 'true');
      }
    });
  }

  // Start loading projects
  loadProjects();

  // Page transition handler (this is fine to leave here)
  document.querySelectorAll('a').forEach(link => {
    // Only intercept internal links
    try {
      if (link.href && link.href.startsWith(window.location.origin)) {
        link.addEventListener('click', function(e) {
          if (this.target !== '_blank' && !this.classList.contains('no-transition')) {
            e.preventDefault();
            document.body.style.animation = 'fadeOut 0.3s ease forwards';
            setTimeout(() => {
              window.location.href = this.href;
            }, 300);
          }
        });
      }
    } catch (err) {
      // some anchors may not have href or be mailto/# â€” ignore
    }
  });
});
</script>

<script src="script.js" defer></script>
</body>
</html>
