<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Projects | Ihuoma Obasi</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" crossorigin="anonymous" />
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Exo:wght@400;700&display=swap" rel="stylesheet">
  </head>
<body>

<a href="#main-content" class="skip-link">Skip to main content</a>

<header>
  <nav class="navbar">
    <div class="logo">Ihuoma's Portfolio</div>
    <ul class="nav-links">
      <li><a href="index.html"><i class="fa-solid fa-house-user"></i>Home</a></li>
      <li><a href="projects.html" class="active"><i class="fa-solid fa-folder-open"></i>Projects</a></li>
      <li><a href="CV.html"><i class="fa-solid fa-file-lines"></i>CV</a></li>
      <li><a href="contact.html"><i class="fa-solid fa-envelope"></i>Contact</a></li>
    </ul>
    <div class="hamburger">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </nav>
</header>

<main class="projects-page" id="main-content">
  <div class="filter-bar">
    <button class="active" data-filter="all">All</button>
    <button data-filter="engineering">Engineering</button>
    <button data-filter="graphic">Graphic</button>
    <button data-filter="interior">Interior</button>
    <div class="tag-filter">
      <input type="text" id="tagInput" placeholder="Filter by tags (arduino, design, etc.)">
    </div>
  </div>

  <div class="grid-container">
    <div class="skeleton" style="height: 200px; border-radius: 15px;"></div>
    <div class="skeleton" style="height: 200px; border-radius: 15px;"></div>
    <div class="skeleton" style="height: 200px; border-radius: 15px;"></div>
  </div>
</main>

<div id="projectModal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <div id="modalContent"></div>
  </div>
</div>

<footer>
  <section class="footer-socials">
    <a href="https://www.instagram.com/stacy_leo15" target="_blank" aria-label="Instagram">
      <i class="fa-brands fa-instagram"></i><span>Instagram</span>
    </a>
    <a href="https://wa.me/2347059255765" target="_blank" aria-label="WhatsApp">
      <i class="fa-brands fa-whatsapp"></i><span>WhatsApp</span>
    </a>
    <a href="https://www.linkedin.com/in/ihuoma-obasi" target="_blank" aria-label="LinkedIn">
      <i class="fa-brands fa-linkedin"></i><span>LinkedIn</span>
    </a>
    <a href="https://github.com/Ihuomaleo" target="_blank" aria-label="GitHub">
      <i class="fa-brands fa-github"></i><span>GitHub</span>
    </a>
    <a href="https://twitter.com/obasi_ihuo42473" target="_blank" aria-label="Twitter">
      <i class="fa-brands fa-x-twitter"></i> <span>Twitter</span>
    </a>
  </section>
  <p>&copy; 2025 Ihuoma Ngozika Obasi</p>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const grid = document.querySelector('.grid-container');

  // Function to build the HTML for a single project card
  function createProjectCard(project) {
    const category = project.category || 'general';
    const tags = project.tags || [];
    const tagsString = tags.join(' ').toLowerCase();
    const tagsHTML = tags.map(tag => `<span>${tag}</span>`).join('');

    let mediaHTML = '';
    if (project.video_mp4) {
      // It's a video project
      const poster = project.video_poster || '';
      mediaHTML = `
        <video controls poster="${poster}" style="display:none">
          <source src="${project.video_mp4}" type="video/mp4">
          Your browser doesn't support videos
        </video>
      `;
    } else if (project.image) {
      // It's an image project
      mediaHTML = `<img src="${project.image}" alt="${project.title}" loading="lazy" style="display:none">`;
    }

    return `
      <div class="card" data-category="${category}" data-tags="${tagsString}">
        <div class="media-container">
          <div class="skeleton"></div>
          ${mediaHTML}
        </div>
        <div class="card-content">
          <h3>${project.title || 'No Title'}</h3>
          <p>${project.description || 'No description.'}</p>
          <div class="card-tags">
            ${tagsHTML}
          </div>
        </div>
      </div>
    `;
  }

  // Function to load and display all projects
  async function loadProjects() {
    try {
      const response = await fetch('/_data/projects.json');
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      const projects = await response.json();
      
      if (projects && projects.length > 0) {
        grid.innerHTML = projects.map(createProjectCard).join('');
      } else {
        grid.innerHTML = "<p>No projects found. Try adding some in the CMS!</p>";
      }
      
      // NOW that projects are loaded, run all the project-specific JS
      initializeProjectScripts();
      
    } catch (error) {
      console.error('Failed to load projects:', error);
      grid.innerHTML = "<p>Error loading projects. Please check the console.</p>";
    }
  }

  // This function contains all the logic that needs to run AFTER projects are on the page
  function initializeProjectScripts() {
    
    // 1. Project Filter Functionality (from script.js)
    if (document.querySelector('.projects-page')) {
      const filterButtons = document.querySelectorAll('.filter-bar button');
      const projectCards = document.querySelectorAll('.card');
      const tagInput = document.getElementById('tagInput');
      
      filterButtons.forEach(button => {
        button.addEventListener('click', () => {
          filterButtons.forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');
          const filterValue = button.dataset.filter;
          
          projectCards.forEach(card => {
            if (filterValue === 'all' || card.dataset.category === filterValue) {
              card.style.display = 'block';
              setTimeout(() => card.style.opacity = '1', 50);
            } else {
              card.style.opacity = '0';
              setTimeout(() => card.style.display = 'none', 300);
            }
          });
        });
      });
      
      if (tagInput) {
        tagInput.addEventListener('input', function() {
          const searchTerm = this.value.trim().toLowerCase();
          projectCards.forEach(card => {
            const tags = card.dataset.tags.toLowerCase();
            if (searchTerm === '' || tags.includes(searchTerm)) {
              card.style.display = 'block';
              setTimeout(() => card.style.opacity = '1', 50);
            } else {
              card.style.opacity = '0';
              setTimeout(() => card.style.display = 'none', 300);
            }
          });
        });
      }
      
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('show');
          }
        });
      }, { threshold: 0.1 });
      projectCards.forEach(card => observer.observe(card));
      
      document.querySelectorAll('.card img, .card video').forEach(media => {
        media.onload = media.onloadeddata = function() {
          const card = this.closest('.card');
          card.classList.add('loaded');
          if (card.querySelector('.skeleton')) {
            card.querySelector('.skeleton').style.display = 'none';
          }
          card.querySelectorAll('.skeleton-text').forEach(el => el.remove());
        };
        if (media.complete) media.onload();
      });
    }

    // 2. Project Modal Functionality (from projects.html)
    const modal = document.getElementById('projectModal');
    const closeBtn = document.querySelector('.close-modal');
    
    document.querySelectorAll('.card').forEach(card => {
      card.addEventListener('click', function() {
        const title = this.querySelector('h3').textContent;
        const description = this.querySelector('p').textContent;
        const mediaElement = this.querySelector('img, video');
        const tags = (this.dataset.tags || '').split(' ');
        const category = this.dataset.category || 'N/A';
        
        const mediaClone = mediaElement ? mediaElement.cloneNode(true) : null;
        if (mediaClone) {
          mediaClone.style.display = 'block';
          mediaClone.removeAttribute('style');
        }
        
        let tagsHTML = '';
        tags.forEach(tag => {
          if (tag) tagsHTML += `<span class="tag">${tag}</span>`;
        });
        
        document.getElementById('modalContent').innerHTML = `
          <h2>${title}</h2>
          <div class="modal-media">
            ${mediaClone ? mediaClone.outerHTML : '<p>No media available</p>'}
          </div>
          <p>${description}</p>
          <div class="project-details">
            <p><strong>Category:</strong> ${category.charAt(0).toUpperCase() + category.slice(1)}</p>
            <p><strong>Tags:</strong> <div class="modal-tags">${tagsHTML}</div></p>
            <a href="#" class="btn no-transition">View Project Details</a>
          </div>
        `;
        
        modal.style.display = 'flex';
      });
    });
    
    if (closeBtn) {
      closeBtn.addEventListener('click', () => modal.style.display = 'none');
    }
    window.addEventListener('click', e => e.target === modal && (modal.style.display = 'none'));
  }

  // Start loading projects
  loadProjects();

  // Page transition handler (this is fine to leave here)
  document.querySelectorAll('a').forEach(link => {
    if (link.href.startsWith(window.location.origin)) {
      link.addEventListener('click', function(e) {
        if (this.target !== '_blank' && !this.classList.contains('no-transition')) {
          e.preventDefault();
          document.body.style.animation = 'fadeOut 0.3s ease forwards';
          setTimeout(() => {
            window.location.href = this.href;
          }, 300);
        }
      });
    }
  });
});
</script>

<script src="script.js" defer></script>
</body>
</html>